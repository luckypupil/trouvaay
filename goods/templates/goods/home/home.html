{% extends '_base.html' %}
{% load staticfiles %}
{% load cloudinary %}
{% block beginjs %}
<script type="text/javascript" 
	src=https://maps.googleapis.com/maps/api/js?key=AIzaSyDZTlXL-J2h0DQO0CVDpXbtKOtn_TTCZTU&sensor=true>
</script>
{% endblock %}

{% block modal %}{% endblock %}

{% block content %}
  {% include 'goods/home/_home_slider.html' %}
  
  {% include 'goods/home/_home_quote.html' %}
  <div class="container">
    <div class="grid-products-wrapper">
        <div class="row">
            {% for piece in pieces %}
                {% include 'goods/home/_home_for_loop.html' %}
            {% endfor %}
        </div>
    </div>
  </div>
{% endblock %}
{% block endjs %}
<script type="text/javascript"> 
	function  getpoints (userloc) {
    var products = {{ products_json|safe }};
    var userloc = {
     // 'lat': userloc.coords.latitude,
     // 'lng': userloc.coords.longitude,
     'lat': 37.798530,
    'lng': -122.417966,
    };
      
      var userpos = new google.maps.LatLng(userloc.lat, userloc.lng);
      initializemap(products, userloc);
      for (i in products) {
        add_dists(userpos,products[i],i);
      } 
    };

  function add_dists(userpos, prod, prodnum) {
    var productpos = new google.maps.LatLng(prod.fields.lat, prod.fields.lng);
    var request = {
          origin: userpos,
          destination: productpos,
          travelMode: google.maps.TravelMode.DRIVING
      };
    var directionsService = new google.maps.DirectionsService();
    directionsService.route(request, function(result, status) {
          if (status == google.maps.DirectionsStatus.OK) {
          }
          $(".dist").eq(prodnum).append('</br>('+result.routes[0].legs[0].distance.text+')');
        });
  };
	navigator.geolocation.getCurrentPosition(getpoints);
</script>
{% endblock %}