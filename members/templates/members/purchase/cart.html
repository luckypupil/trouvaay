{% extends '_base.html' %}
{% load cloudinary %}
{% block content %}

<div class='col-sm-8 col-sm-offset-2' id="first-content-after-nav" style="margin-top:30px">
{% if empty %}

<h1 style='text-align:center;'>{{ empty_message }}</h1>

{% else %}


<table class='table'>
<thead>
<th>Item</th>
<th></th>
<th>Price</th>
<th></th>
</thead>
<tfoot>
<tr>
<td></td>
<td></td>
<td><a href="{% url 'members:checkout' %}">
	<button type="button" class="btn btn-default">Checkout</button>
</a></td>
<td></td>
</tr>
</tfoot>


{% for product in cart.saved_items.all %}
<tr id="prodrow_{{ product.id }}">
<td>{{ product.short_name }}</td> 
<td>{% cloudinary product.productimage_set.first.image width=100 height=100 crop="fill" %} </td>
<td>{{ product.current_price }}</td>
<td></td>
<td><a class="btn btn-link" id="prodremove_{{ product.id}}" href='#'>Remove</a></tr>
{% endfor %}
<tr class="tfoot">
<td></td>
<td>Total</td>
<td id="total">{{ cart.get_cart_total }}</td>
<td></td>
</tr>
</table>
{% endif %}
</div>
{% endblock %}
{% block endjs %}
 <script type="text/javascript">

	$(document).ready(function(){
		$(".btn.btn-link").click(function() {
			var id = $(this).attr("id").substring(11);
	    	var data = {'id': id};
	    	$.post("{% url 'members:removefromcart' %}", data, function(product) {
		    		var row = 'prodrow_'+product.id;
		    		console.log(row);
		    		document.getElementById(row).remove();
		    		$("#total").html(product.total.toString());
		    		$(".badge.cart-counter ").html(product.count.toString());
	    		});
		});
	});
</script>
{% endblock %}